<div class="p-4 space-y-6 max-w mx-auto">
  <h1 class="text-2xl font-semibold">Νέο Άρθρο</h1>

  <form [formGroup]="form" (ngSubmit)="onSubmit()" class="space-y-4">
    <div class="grid grid-cols-1 sm:grid-cols-1 md:grid-cols-1 gap-4">
      <!-- Title -->
      <div>
        <label class="block text-sm font-medium">Τίτλος Άρθρου</label>
        <input
          type="text"
          formControlName="title"
          class="block w-full border rounded p-2 bg-white dark:bg-gray-900 transition-colors duration-300"
          [class.border-red-500]="hasError('title')"
          placeholder="Γράψε έναν καθαρό τίτλο…"
        />
        @if(hasError('title')) {
        <p
          class="border rounded p-2 bg-white dark:bg-gray-900 transition-colors duration-300"
        >
          Ο τίτλος είναι υποχρεωτικός (4–160 χαρακτήρες).
        </p>
        }
      </div>
    </div>
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
      <!-- Category -->
      <div>
        <label class="block text-sm font-medium">Κατηγορία</label>
        <select
          formControlName="category_id"
          class="block w-full border rounded p-2 bg-white dark:bg-gray-900"
        >
          <option value="" disabled selected>Επίλεξε κατηγορία…</option>
          @for(c of categoryList; track c.id) {
          <option [value]="c.id">{{ c.name }}</option>
          }
        </select>
        @if (hasError('category_id')) {
        <p
          class="border rounded p-2 bg-white dark:bg-gray-900 transition-colors duration-300"
        >
          Η κατηγορία είναι υποχρεωτική.
        </p>
        }
      </div>

      <!-- User -->
      <div>
        <label class="block text-sm font-medium">Χρήστης</label>
        <select
          formControlName="user_id"
          class="block w-full border rounded p-2 bg-white dark:bg-gray-900"
        >
          <option value="" disabled selected>Επίλεξε χρήστη…</option>
          @for(u of usersList; track u.id) {
          <option [value]="u.id">{{ u.name }}</option>
          }
        </select>
        @if (hasError('user_id')) {
        <p
          class="border rounded p-2 bg-white dark:bg-gray-900 transition-colors duration-300"
        >
          Ο χρήστης είναι υποχρεωτικός.
        </p>
        }
      </div>
      <!-- Status -->
      <div>
        <label class="block text-sm font-medium">Κατάσταση</label>
        <select
          formControlName="status"
          class="block w-full border rounded p-2 bg-white dark:bg-gray-900"
        >
          <option value="" disabled selected>Επίλεξε κατάσταση…</option>
          @for(u of SubmitMode; track u) {
          <option [value]="u">{{ u }}</option>
          }
        </select>
        @if (hasError('status')) {
        <p
          class="border rounded p-2 bg-white dark:bg-gray-900 transition-colors duration-300"
        >
          Η κατάσταση είναι υποχρεωτική.
        </p>
        }
      </div>
    </div>
    <!-- Featured Image -->
    <div class="space-y-2">
      <label class="block text-sm font-medium">Featured Image</label>

      <div class="flex items-center gap-3">
        <input
          #featuredInput
          type="file"
          accept=".jpg,.jpeg,.png,.gif"
          (change)="onFeaturedPicked($event)"
          [disabled]="featuredUploading()"
          class="block w-full border rounded p-2 bg-white dark:bg-gray-900 transition-colors duration-300"
        />
        <button
          type="button"
          class="px-3 py-2 rounded border bg-gray-50 dark:bg-gray-800 disabled:opacity-50"
          (click)="clearFeatured(featuredInput)"
          [disabled]="!featuredUrl() && !featuredUploading()"
        >
          Καθαρισμός
        </button>
      </div>

      <div *ngIf="featuredUploading()" class="w-full h-2 bg-gray-200 rounded">
        <div
          class="h-2 bg-blue-600 rounded transition-all"
          [style.width.%]="featuredProgress()"
        ></div>
        <p class="text-xs text-gray-500 mt-1">{{ featuredProgress() }}%</p>
      </div>

      <div *ngIf="featuredUrl()" class="mt-2">
        <img
          [src]="featuredUrl()!"
          alt="Featured"
          class="max-h-48 rounded border object-contain"
        />
        <p class="text-xs text-gray-500 mt-1">Θα σταλεί με το άρθρο ως URL.</p>
      </div>

      <p *ngIf="featuredError()" class="text-xs text-red-600">
        {{ featuredError() }}
      </p>
    </div>

    <!-- Content -->
    <div>
      <app-tiny-editor
        formControlName="full_content"
        [uploadUrl]="'http://localhost/datatex_platform/api/public/api/uploadimage'"
      ></app-tiny-editor>
      @if (hasError('full_content')) {
      <p
        class="border rounded p-2 bg-white dark:bg-gray-900 transition-colors duration-300"
      >
        Το περιεχόμενο είναι υποχρεωτικό.
      </p>
      }
    </div>

    <!-- Actions -->
    <div class="flex items-center gap-3 pt-2">
      <button
        type="submit"
        class="px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50"
        [disabled]="form.invalid || loading()"
      >
        Δημοσίευση
      </button>
    </div>
  </form>

  <!-- Live Preview -->
  <div class="text-sm text-gray-700 border-t pt-4">
    <strong class="block mb-2">Τρέχον περιεχόμενο:</strong>
    <pre
      class="whitespace-pre-wrap bg-gray-50 p-3 rounded max-h-72 overflow-auto"
      >{{ form.value | json }}</pre
    >
  </div>
</div>
